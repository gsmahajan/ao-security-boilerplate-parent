db._query(`FOR person IN cloudseer_peoples UPDATE person WITH { vpn_network_devices: (FOR l in (FOR q in person.activities.vpn[*].session FOR g in DOCUMENT(q) COLLECT nd = g.event.Network_Device, loc = g.event.Location with count into length RETURN { device_id: (FOR o in cloudseer_vpn_network_device FILTER o.Network_Device == nd RETURN o._id)[0], name:nd, location: loc, count:length }) SORT l.count DESC,  l.network_device, l.location RETURN l) } INTO cloudseer_peoples`).getExtra()
